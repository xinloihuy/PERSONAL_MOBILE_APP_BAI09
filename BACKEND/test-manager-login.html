<!DOCTYPE html>
<html>
<head>
    <title>Manager Login Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>ğŸ”§ Manager Login Debug Test</h1>
    
    <div>
        <button onclick="testManagerLogin()">Test Manager Login</button>
        <button onclick="testCustomerLogin()">Test Customer Login (Control)</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div id="log" style="border: 1px solid #ccc; height: 500px; overflow-y: scroll; padding: 10px; margin-top: 10px; font-family: monospace;"></div>
    
    <script>
        let socket;
        let connectionCount = 0;
        
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            log.innerHTML += '<div style="color: ' + color + '">' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            log.scrollTop = log.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function connectSocket() {
            if (socket) {
                socket.disconnect();
            }
            
            connectionCount++;
            addLog('ğŸ”„ [' + connectionCount + '] Connecting to server...');
            
            socket = io('http://localhost:9092', {
                forceNew: true,
                timeout: 10000
            });
            
            socket.on('connect', () => {
                addLog('âœ… [' + connectionCount + '] Connected! ID: ' + socket.id, 'success');
            });
            
            socket.on('connected', (data) => {
                addLog('ğŸ‰ [' + connectionCount + '] Server welcome: ' + data);
            });
            
            socket.on('login_response', (data) => {
                addLog('ğŸ“¥ [' + connectionCount + '] Login response received:', 'info');
                addLog('   Success: ' + data.success, data.success ? 'success' : 'error');
                addLog('   Username: ' + data.username);
                addLog('   Role: ' + data.role);
                addLog('   Token: ' + (data.token ? data.token.substring(0, 20) + '...' : 'null'));
                addLog('   Message: ' + data.message);
                if (data.error) {
                    addLog('   Error: ' + data.error, 'error');
                }
            });
            
            socket.on('disconnect', (reason) => {
                addLog('âŒ [' + connectionCount + '] Disconnected: ' + reason, 'error');
            });
            
            socket.on('connect_error', (error) => {
                addLog('ğŸš« [' + connectionCount + '] Connection Error: ' + error.message, 'error');
            });
            
            socket.on('error', (error) => {
                addLog('ğŸš« [' + connectionCount + '] Socket Error: ' + error, 'error');
            });
        }
        
        function testManagerLogin() {
            addLog('=== TESTING MANAGER LOGIN ===');
            connectSocket();
            
            setTimeout(() => {
                if (socket && socket.connected) {
                    addLog('ğŸ”‘ Sending manager login...');
                    socket.emit('login', {
                        username: 'manager',
                        password: '123456',
                        role: 'MANAGER'
                    });
                } else {
                    addLog('âŒ Socket not connected!', 'error');
                }
            }, 1000);
        }
        
        function testCustomerLogin() {
            addLog('=== TESTING CUSTOMER LOGIN (CONTROL) ===');
            connectSocket();
            
            setTimeout(() => {
                if (socket && socket.connected) {
                    addLog('ğŸ”‘ Sending customer login...');
                    socket.emit('login', {
                        username: 'customer1',
                        password: '123456',
                        role: 'CUSTOMER'
                    });
                } else {
                    addLog('âŒ Socket not connected!', 'error');
                }
            }, 1000);
        }
        
        // Auto-start with manager test
        addLog('ğŸš€ Manager Login Debug Tool Ready');
        addLog('ğŸ“‹ Click "Test Manager Login" to debug the issue');
    </script>
</body>
</html>